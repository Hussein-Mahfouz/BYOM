getwd()
library(tidyverse)
# this is a lookup table matching MSOAs to major towns and cities
city_names <- readr::read_csv('Middle_Layer_Super_Output_Area__2011__to_Major_Towns_and_Cities__December_2015__Lookup_in_England_and_Wales.csv')
# change column name
city_names <- city_names %>%
dplyr::rename(city = TCITY15NM)
city_names
# flow data from the 2011 census https://www.nomisweb.co.uk/census/2011/bulk/rOD1
flows <- read_csv('flow_data.csv')
head(flows)
flows <- flows %>% group_by(`Area of workplace`) %>%
summarize(jobs = sum(`All categories: Method of travel to work`))
flows %>% group_by(`Area of workplace`) %>%
summarize(jobs = sum(`All categories: Method of travel to work`))
# flow data from the 2011 census https://www.nomisweb.co.uk/census/2011/bulk/rOD1
flows <- read_csv('flow_data.csv')
head(flows)
flows %>% group_by(`Area of workplace`) %>%
summarize(jobs = sum(`All categories: Method of travel to work`))
flows <- flows %>% group_by(`Area of workplace`) %>%
summarize(jobs = sum(`All categories: Method of travel to work`))
head(flows)
# flow data from the 2011 census https://www.nomisweb.co.uk/census/2011/bulk/rOD1
flows <- read_csv('flow_data.csv')
head(flows)
flows <- flows %>% group_by(`Area of workplace`) %>%
summarize(jobs = sum(`All categories: Method of travel to work`))
head(flows)
# add a column with the city name corresponding to each Workplace MSOA
flows <- flows %>%
left_join(city_names[,c("MSOA11CD", "city")], by = c("Area of workplace" = "MSOA11CD"))
head(flows)
MSOAS <- flows %>% dplyr::filter(city == "Manchester")
library(tidyverse)
library(osmdata)
View(MSOAS)
roads <- opq("Manchester UK") %>%
add_osm_feature(key = 'highway')
View(roads)
plot(roads)
plot(roads$osmlines)
View(roads)
roads <- opq("manchester uk") %>%
add_osm_feature(key = 'highway')
View(roads)
roads$features
roads <- opq(bbox = "manchester uk") %>%
add_osm_feature(key = 'highway')
roads <- opq(bbox = "manchester uk") %>%
add_osm_feature(key = 'highway')  %>%
osmdata_sf ()
plot(st_geometry(roads))
library(sf)
plot(st_geometry(roads))
library(sf)
roads %>% st_as_sf %>% plot(st_geometry())
View(roads)
library(sf)
plot(st_geometry(roads$osm_lines))
roads <- opq(bbox = "manchester uk") %>%
add_osm_feature(key = 'highway')
library(sf)
roads2 <- osmdata_sf(roads)
plot(st_geometry(roads2$osm_lines))
osmdata_xml(roads, filename = 'manchester.osm')
View(MSOAS)
# get geometry of msoas_city. We nned this geometry for plotting later
msoa_geom <- sf::st_read("MSOA_2011_Boundaries/Middle_Layer_Super_Output_Areas__December_2011__Boundaries.shp") %>%
st_transform(4326)
# filter only MSOAs in the msoas_city df
msoa_geom <- city_geom %>% dplyr::filter(msoa11cd %in% MSOAS$`Area of Workplace`)
# filter only MSOAs in Manchester, using the MSOAS df
msoa_geom <- msoa_geom %>% dplyr::filter(msoa11cd %in% MSOAS$`Area of Workplace`)
plot(st_geometry(msoa_geom))
# get geometry of msoas_city. We nned this geometry for plotting later
msoa_geom <- sf::st_read("MSOA_2011_Boundaries/Middle_Layer_Super_Output_Areas__December_2011__Boundaries.shp") %>%
st_transform(4326)
# filter only MSOAs in Manchester, using the MSOAS df
msoa_geom <- msoa_geom %>% dplyr::filter(msoa11cd %in% MSOAS$`Area of Workplace`)
plot(st_geometry(msoa_geom))
# get geometry of msoas_city. We nned this geometry for plotting later
msoa_geom <- sf::st_read("MSOA_2011_Boundaries/Middle_Layer_Super_Output_Areas__December_2011__Boundaries.shp") %>%
st_transform(4326)
# filter only MSOAs in Manchester, using the MSOAS df
msoa_geom <- msoa_geom %>% dplyr::filter(msoa11cd %in% MSOAS$`Area of Workplace`)
plot(st_geometry(msoa_geom))
# get geometry of msoas_city. We nned this geometry for plotting later
msoa_geom <- sf::st_read("MSOA_2011_Boundaries/Middle_Layer_Super_Output_Areas__December_2011__Boundaries.shp") %>%
st_transform(4326)
View(msoa_geom)
View(MSOAS)
msoa_geom %>% dplyr::filter(msoa11cd %in% MSOAS$`Area of workplace`)
# filter only MSOAs in Manchester, using the MSOAS df
msoa_geom <- msoa_geom %>% dplyr::filter(msoa11cd %in% MSOAS$`Area of workplace`)
plot(st_geometry(msoa_geom))
st_coordinates(st_centroid(msoa_geom))
st_centroid(msoa_geom)
st_coordinates(st_centroid(msoa_geom))
centroids <- st_coordinates(st_centroid(msoa_geom))
centroids
centroids <- st_coordinates(st_centroid(msoa_geom))
head(centroids)
View(msoa_geom)
cbind(MSOAS, centroids)
MSOAS <- cbind(MSOAS, centroids)
View(MSOAS)
